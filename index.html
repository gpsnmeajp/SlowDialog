<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SlowDialog</title>
  <meta name="description" content="ゲームボーイ風AIチャットアプリ - 会話の主体を人間に戻す">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- ===== ツールバー ===== -->
  <header id="toolbar">
    <h1 id="app-title">SlowDialog</h1>
    <div id="toolbar-buttons">
      <button id="btn-settings" title="設定">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3" />
          <path
            d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z" />
        </svg>
      </button>
      <button id="btn-export" title="履歴エクスポート">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M10 3v10M10 13l-3-3M10 13l3-3M4 15h12" stroke="currentColor" stroke-width="2"
            stroke-linecap="square" />
        </svg>
      </button>
      <button id="btn-import" title="履歴インポート">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M10 17V7M10 7l-3 3M10 7l3 3M4 5h12" stroke="currentColor" stroke-width="2"
            stroke-linecap="square" />
        </svg>
      </button>
      <button id="btn-clear" title="会話クリア">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M5 5h10M8 5V4h4v1M6 5v11h8V5" stroke="currentColor" stroke-width="2" stroke-linecap="square" />
        </svg>
      </button>
    </div>
  </header>

  <!-- ===== チャットエリア ===== -->
  <main id="chat-area">
    <div id="chat-messages"></div>
  </main>

  <!-- ===== 入力エリア ===== -->
  <footer id="input-area">
    <textarea id="user-input" placeholder="メッセージを入力..." rows="1"></textarea>
    <button id="btn-send" title="送信">
      <svg width="22" height="22" viewBox="0 0 22 22" fill="none">
        <path d="M4 11l14-7-7 14v-7H4z" fill="currentColor" />
      </svg>
    </button>
  </footer>

  <!-- ===== 設定ダイアログ ===== -->
  <div id="settings-overlay" class="hidden">
    <div id="settings-dialog">
      <h2>設定</h2>
      <form id="settings-form">
        <label for="setting-baseurl">Base URL</label>
        <input type="url" id="setting-baseurl" placeholder="https://api.openai.com/v1">

        <label for="setting-apikey">API Key</label>
        <input type="password" id="setting-apikey" placeholder="sk-...">

        <label for="setting-model">モデル名</label>
        <input type="text" id="setting-model" placeholder="gpt-4o-mini">

        <label for="setting-systemprompt">システムプロンプト</label>
        <textarea id="setting-systemprompt" rows="3" placeholder="あなたは親切なアシスタントです。"></textarea>

        <label for="setting-font">フォント</label>
        <select id="setting-font">
          <option value="k8x12S">k8x12S</option>
          <option value="k8x12">k8x12</option>
          <option value="k8x12L">k8x12L</option>
          <option value="MisakiGothic">美咲ゴシック</option>
          <option value="NotoSansJP">Noto Sans JP</option>
        </select>

        <label for="setting-theme">カラーテーマ</label>
        <select id="setting-theme">
          <option value="gb">GBクラシック</option>
          <option value="gb-inv">GBクラシック (反転)</option>
          <option value="red">レッド</option>
          <option value="red-inv">レッド (反転)</option>
          <option value="amber">アンバー</option>
          <option value="amber-inv">アンバー (反転)</option>
          <option value="green">グリーン</option>
          <option value="green-inv">グリーン (反転)</option>
          <option value="blue">ブルー</option>
          <option value="blue-inv">ブルー (反転)</option>
          <option value="mono">モノクロ</option>
          <option value="mono-inv">モノクロ (反転)</option>
        </select>

        <label class="checkbox-row">
          <input type="checkbox" id="setting-autoadvance" checked>
          自動進行
        </label>

        <label class="checkbox-row">
          <input type="checkbox" id="setting-sound" checked>
          効果音
        </label>

        <label for="setting-chardelay">1文字あたりの待ち時間 (ms)</label>
        <input type="number" id="setting-chardelay" min="0" max="1000" value="50">

        <label for="setting-mindelay">最低待機時間 (秒)</label>
        <input type="number" id="setting-mindelay" min="0" max="30" step="0.1" value="2">

        <label for="setting-contextsize">コンテキストサイズ (メッセージ数)</label>
        <input type="number" id="setting-contextsize" min="2" max="200" value="20">

        <div id="settings-buttons">
          <button type="submit" id="btn-save-settings">保存</button>
          <button type="button" id="btn-cancel-settings">キャンセル</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== イントロダイアログ ===== -->
  <div id="intro-overlay" class="hidden">
    <div id="intro-dialog">
      <h2>SlowDialog</h2>
      <p>ようこそ。</p>
      <p>SlowDialogは、AIとの会話の主体を<strong>あなた</strong>に取り戻すためのチャットアプリです。</p>
      <p>AIの返答は、まるで人間が打っているかのように、少しずつ届きます。考える時間が生まれ、会話がもっと自然になります。</p>
      <p>あなたはいつでも「割り込み」ができます。AIがまだ話している途中でも、メッセージを送れば、AIは言いかけた言葉を飲み込み、あなたの声に耳を傾けます。</p>
      <p>ゆっくり、あなたのペースで。</p>
      <button id="btn-intro-next">はじめる</button>
    </div>
  </div>

  <!-- ===== インポートダイアログ ===== -->
  <div id="import-overlay" class="hidden">
    <div id="import-dialog">
      <h2>履歴インポート</h2>
      <div id="import-content">
        <label for="import-file" class="import-file-label">ファイルを選択</label>
        <input type="file" id="import-file" accept=".json">
        <div class="import-divider"><span>または</span></div>
        <label for="import-json">JSONを貼り付け</label>
        <textarea id="import-json" rows="6" placeholder='[{"role":"user","content":"..."}]'></textarea>
        <div id="import-error" class="hidden"></div>
        <div id="import-buttons">
          <button type="button" id="btn-import-exec">インポート</button>
          <button type="button" id="btn-import-cancel">キャンセル</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== クリア確認ダイアログ ===== -->
  <div id="confirm-overlay" class="hidden">
    <div id="confirm-dialog">
      <p>本当にクリアしますか？</p>
      <p class="confirm-sub">必要であれば先にエクスポートをしてください。</p>
      <div id="confirm-buttons">
        <button id="btn-confirm-ok">クリア</button>
        <button id="btn-confirm-cancel">キャンセル</button>
      </div>
    </div>
  </div>

  <!-- ===== リトライバー ===== -->
  <div id="retry-bar" class="hidden">
    <span>通信に失敗しました</span>
    <button id="btn-retry">リトライ</button>
  </div>

  <script src="app.js"></script>
</body>

</html>